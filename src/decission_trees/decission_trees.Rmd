Classification of datasets using decission trees
========================================================
The following example illustrates the classification of the iris data set which
is part of the R base installation. It gives measurements of sepal length, sepal
width, petal length and petal width for 50 flowers of the species Iris setosa, 
Iris versicolor, and Iris virginica. 

In order to make visual things easier, Iris setosa is abbrevated as "S", 
Iris versicolor as "C", and Iris virginica as "G". This is what is done in the
following lines.

```{r, warning=FALSE}
data(iris)
iris$Label <- substr(iris$Species, 1, 3)
iris$Label <- replace(iris$Label, which(iris$Label=="set"), "S")
iris$Label <- replace(iris$Label, which(iris$Label=="ver"), "C")
iris$Label <- replace(iris$Label, which(iris$Label=="vir"), "G")
```

Since we want to predict the species based on the width/length variables, let's
first have a look if we can identify seperated clusters of classes. For 
simplicity, only the case of sepal length vs. width and petal legnth vs. width
is visualized.
```{r fig.width=7, fig.height=6, warning=FALSE}
library(latticeExtra)

xyplot(Sepal.Length ~ Sepal.Width, data = iris, groups = iris$Label, pch = 15,
       panel=function(x, y, ...){
         panel.xyplot(x, y, ...);
         ltext(x=x, y=y, labels=iris$Label, pos=1, offset=1, cex=1.0)
       })

xyplot(Petal.Length ~ Petal.Width, data = iris, groups = iris$Label, pch = 15,
       main = "Iris species as function of petal width and length",
       panel=function(x, y, ...){
         panel.xyplot(x, y, ...);
         ltext(x=x, y=y, labels=iris$Label, pos=1, offset=1, cex=1.0)
       })
```

While the sepal parameters do not clearly separate the species, the pental 
measurements show a very good seperation between S and C and G while the latter
two species are overlaping to some extend.

Let's see how a decission tree performs on that data set.
```{r, warning=FALSE}
library(rpart)
pred <- rpart(Label ~ Sepal.Length + Sepal.Width + Petal.Length + Petal.Width,
              data=iris, method="class")
printcp(pred)
```
As evident from the complexity parameter table function, only the variables 
Petal.Length and Petal.Width are used by the final tree. The cross validation 
error (column xerror) is continously decreasing over the depth of the tree which
starts at level 1 (first row) and ends at level 3 (third row). This can also
be seen in the respective plot.
```{r fig.width=7, fig.height=6, warning=FALSE}
plotcp(pred)
```
A cross validation error of 0.09 is something we can live with for the moment.
So let's have a look at the tree.
```{r fig.width=7, fig.height=6, warning=FALSE}
plot(pred, uniform=TRUE, main="Classification Tree for IRIS data set")
text(pred, use.n=TRUE, all=TRUE, cex=0.75)
```
As evident from the petal plot above, species S can be clearly distinguished
by a petal length threshold of 2.45. For species C and G the seperation is not
optimal and C will also be predicted for 5 of the G species (node 4) while
G will be falsly predicted for 1 C species (node 5).

In terms of the petal width vs. length plot, this decission tree can be 
visualized using one pair of horizontal and vertical line which represents
the threshold values of the nodes.
```{r fig.width=7, fig.height=6, warning=FALSE}
xyplot(Petal.Length ~ Petal.Width, data = iris, groups = iris$Label, pch = 15,
       main = "Iris species as function of petal width and length",
       panel=function(x, y, ...){
         panel.xyplot(x, y, ...);
         panel.abline(h = 2.45);
         panel.abline(v = 1.75);
         ltext(x=x, y=y, labels=iris$Label, pos=1, offset=1, cex=1.0)
       })
```

To get a very detailed view of the decision structure one can also have a look
at the summary of the decission tree object. It shows the decision at each node
but of course, the graphical representation above is much nicer vor human
beings.
```{r, warning=FALSE}
summary(pred)
```
Here one can see that also the sepal parameters have been tested but since they
never add an improve over the petal parameters, they are not used in the final
tree.

Just as a final note, the party package provides similar functionality but withvery nice visualizations of the trees.
```{r, warning=FALSE}
library(party)
tree <- ctree(Species ~ Sepal.Length + Sepal.Width + Petal.Length + Petal.Width,
              data=iris)
print(tree)
plot(tree)
```
